# 4.1 mysql 엔진
mysql엔진 클라이언트로부터 받은 쿼리요청을 처리하는 커넥션 핸들러, sql 파서, sql 전처리기, 최적하된 쿼리로 처리할수 있게하는 옵티마이저로 이루어져 있다.

### 스토리지 엔진
 mysql엔지은 요청된 sql문장을 분석하거나 최적하는등 DBMS의 두뇌에 해당하는 처리를 수행한다. 실제데이터을 디스크로부터 읽거나,쓰거나 하는 작업을 하고 mysql엔진은 하나이지만 스토리지 엔진은 여러개을 만들수 있다.

    create table test_table (fd1 int,fd2,int) engine =innodb
    
### 핸들러 API 
mysql 엔진에 쿼리을 쓰거나 읽어야 할때 각 스토리지 엔진에게 요청을 하는데 이러한 요청을 핸들러 요청이라고 하고 핸들러을 통한작업은

    show global status like 'Handler%';

## 포그라운드 스레드(클라이언트 스레드)

mysql 서버에 접속된 클라이언트 만큼 수가 존재하고 주로 각 클라이언트에 쿼리요청을 처리한다
이때 스레드에 일정갯수만 존재하게 시켜 대기중인 스레드가있으면 스레드에 넣지않고 종료시켜 일정 스레드만 존재할수 있게한다
이때 포그라운드 스레드는 데이터을 mysql의 데이터버퍼나 캐시로부터 가져오는데 없으면 직접 디스크로부터 데이터을 읽어와서 작업을 처리한다 쓰기작업은 백그라운드을 통해 디스크 쓰기 작업을 실행한다.


## 백그라운드 스레드
innodb 에서 다음같이 여러가지 작업을 백그라운드 스레드로 처리한다

- 인서트를 병합하는 스레드
- 로그를 디스크로 기록하는 스레드
- innodb 버퍼풀의 데이터를 디스크에 기록하는 스레드
- 데이터를 버퍼로 읽어 오는 스레드 
- 잠금이나 데드락을 모니터링하는 스레드

이중에 가장 중요한거는 로그 스레드와, 버퍼로 부터 데이터을 쓰는 스레드이다.
다음과 같은 시스템 변수로 읽기 스레드와 쓰기 쓰레드에 갯수을 지정 할수 있다

- hread_write_io_threads
- hread_read_io_threads

읽기 쓰레드는 보통 포그라운드 쓰레드로 처리 되어서 많이 필요는 없지만
쓰기쓰레는 일반적으로 내장 디스크를 사용할때는 2~4정도 DAS나 SAN과 같은 스토리지를 사용할때는 최적으로 사용할 만큼 충분히 설정하는게 좋다.

innodb는 사용자가 insert,update,delete등에 쓰기작업을 할떄 여러개 실행하면 지연(버퍼링)될수는 있지만 쓰기작업중 데이터을 읽기작업을할떄 쓰기작업에 대한 내용을 버퍼링 하여 일괄적으로 처리하기 떄문에 읽기작업에 대한 지연은 절대 없다.



## 메모리 할당 및 사용구조

### 글로벌 영역
- innodb 버퍼 풀
- myisam 키 캐시
- 바이너리 로그 버퍼
- 리두 로그 버퍼
- 테이블 캐시 

### 세션(커넥션) 메모리 영역

- 조인 버퍼
- 정렬 버퍼
- 네트워크 버퍼
- 리드 버퍼





